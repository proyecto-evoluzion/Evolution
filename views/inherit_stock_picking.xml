<?xml version="1.0"?>
<odoo>

	<record id="inherit_vpicktree" model="ir.ui.view">
         <field name="name">inherit.vpicktree</field>
         <field name="model">stock.picking</field>
         <field name="inherit_id" ref="stock.vpicktree"/>
         <field name="arch" type="xml">
              <xpath expr="//tree" position="attributes">
                  <attribute name="default_order">name desc</attribute>
              </xpath>
         </field>
    </record>

    <record id="inherit_view_picking_form" model="ir.ui.view">
       <field name="name">inherit.view.picking.form</field>
       <field name="model">stock.picking</field>
       <field name="inherit_id" ref="stock.view_picking_form"/>
       <field name="arch" type="xml">
            <div name="button_box" position="inside">
              <button name="cost_calculation"
                  string="Calcular costos"
                  class="oe_stat_button"
                  icon="fa-arrows-v"
                  type="object"
                  attrs="{'invisible': [('state', '!=', 'done')]}"/>

                  <!-- TO-DO: Delete after use. -->
                  <button name="stock_quant_update"
                  string="Actualizar Stock"
                  class="oe_stat_button"
                  icon="fa-arrows-v"
                  type="object"/>
            </div>

            <field name="location_id" position="after">
              <field name="pivot_invisible" invisible="1" force_save="1"/>
              <field name="aux_move_lines" invisible="1" force_save="1"/>
            </field>

            <xpath expr="//field[@name='move_lines']/tree" position="attributes">
                <attribute name="default_order">product_id asc</attribute>
                <attribute name="limit">10000</attribute>
            </xpath>

            <field name="quantity_done" position="after">
                <field name="product_cost" readonly="1" force_save="1"/>
            </field>

            <field name="reserved_availability" position="attributes">
              <attribute name="invisible">1</attribute>
            </field>

            <xpath expr="//field[@name='move_lines']/tree/field[@name='product_uom_qty']" position="replace">
              <field name="product_uom_qty" string="Demanda Inicial"/>
            </xpath>

            <!--Se fijan nuevos campos despues de la linea de productos-->
            <field name="move_lines" position="after">
                <strong class="pull-right">
                  <label for="total_cost"/>:<br/>
                  <field name="total_cost" readonly="1" force_save="1"/>
                </strong>
            </field>

            <field name="move_lines" position="after">
              <field name="out_move_lines" attrs="{'readonly': ['|', '&amp;', ('show_operations', '=', True), '|', ('is_locked', '=', True), ('state', '=', 'done'), '&amp;', ('state', '=', 'done'), ('is_locked', '=', True)],'invisible': [('pivot_invisible', '=', True)]}" context="{'picking_type_code': picking_type_code, 'default_picking_id': id, 'form_view_ref':'stock.view_move_picking_form', 'address_in_id': partner_id, 'default_picking_type_id': picking_type_id, 'default_location_id': location_id, 'default_location_dest_id': location_dest_id}">
                <tree string="Stock Moves" editable="bottom" default_order="product_id asc" limit="10000">
                  <field name="name" invisible="1"/>
                  <field name="date_expected" invisible="1"/>
                  <field name="state" invisible="1" readonly="0"/>
                  <field name="picking_type_id" invisible="1"/>
                  <field name="location_id" invisible="1"/>
                  <field name="location_dest_id" invisible="1"/>
                  <field name="product_id" required="1" attrs="{'readonly': [('state', '!=', 'draft')]}" string="Producto"/>
                  <field name="product_uom_qty" string="Demanda Inicial"/>
                  <field name="product_delivered"/>
                  <field name="quantity_done"/>
                  <field name="product_return" readonly="1" force_save="1"/>
                  <field name="product_cost" readonly="1" force_save="1"/>
                  <field name="product_uom" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_open': True, 'no_create': True}" string="Unidad de Medida" groups="product.group_uom"/>
                  <button name="action_show_details" string="Lotes" type="object" icon="fa-list" attrs="{'invisible': [('show_details_visible', '=', False)]}" options="{&quot;warn&quot;: true}"/>
                  <field name="show_details_visible" invisible="1"/>
                </tree>
              </field>
              <field name="in_move_lines" attrs="{'readonly': ['|', '&amp;', ('show_operations', '=', True), '|', ('is_locked', '=', True), ('state', '=', 'done'), '&amp;', ('state', '=', 'done'), ('is_locked', '=', True)],'invisible': [('pivot_invisible', '=', False)]}" context="{'picking_type_code': picking_type_code, 'default_picking_id': id, 'form_view_ref':'stock.view_move_picking_form', 'address_in_id': partner_id, 'default_picking_type_id': picking_type_id, 'default_location_id': location_id, 'default_location_dest_id': location_dest_id}">
                <tree string="Stock Moves" editable="bottom" default_order="product_id asc" limit="10000">
                  <field name="name" invisible="1"/>
                  <field name="date_expected" invisible="1"/>
                  <field name="state" invisible="1" readonly="0"/>
                  <field name="picking_type_id" invisible="1"/>
                  <field name="location_id" invisible="1"/>
                  <field name="location_dest_id" invisible="1"/>
                  <field name="product_id" required="1" attrs="{'readonly': [('state', '!=', 'draft')]}" string="Producto"/>
                  <field name="product_uom_qty" string="Cantidad solicitada"/>
                  <field name="quantity_done"/>
                  <field name="product_cost" readonly="1" force_save="1"/>
                  <field name="product_uom" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_open': True, 'no_create': True}" string="Unidad de Medida" groups="product.group_uom"/>
                  <button name="action_show_details" string="Lotes" type="object" icon="fa-list" attrs="{'invisible': [('show_details_visible', '=', False)]}" options="{&quot;warn&quot;: true}"/>
                  <field name="show_details_visible" invisible="1"/>
                </tree>
              </field>
            </field>

            <field name="move_lines" position="attributes">
              <attribute name="attrs">{'invisible': [('aux_move_lines', '=', False)]}</attribute>
            </field>

       </field>
    </record>

    <!--Para vista de Lotes / Fecha vencimiento-->
    <record id="stock.view_stock_move_operations" model="ir.ui.view">
        <field name="name">stock.move.operations.form</field>
        <field name="model">stock.move</field>
        <field name="priority">1000</field>
        <field name="arch" type="xml">
            <form string="Operaciones detalladas">
                <field name="state" invisible="1"/>
                <field name="location_id" invisible="1"/>
                <field name="location_dest_id" invisible="1"/>
                <field name="picking_id" invisible="1"/>
                <field name="is_locked" invisible="1"/>
                <group>
                    <group>
                        <field name="product_id" readonly="1"/>
                        <label for="product_uom_qty"/>
                        <div class="o_row">
                            <span><field name="product_uom_qty" readonly="1" nolabel="1"/></span>
                            <span><field name="product_uom" readonly="1" nolabel="1"/></span>
                        </div>
                        <label for="quantity_done"/>
                        <div class="o_row">
                            <span><field name="quantity_done" readonly="1" nolabel="1"/></span>
                            <span attrs="{'invisible': [('state', '=', 'done')]}"> / </span>
                            <span><field name="reserved_availability" nolabel="1" attrs="{'invisible': [('state', '=', 'done')]}" /></span>
                            <span><field name="product_uom" readonly="1" nolabel="1"/></span>
                        </div>

                    </group>
                </group>
                <field name="move_line_ids" attrs="{'readonly': ['|', ('state', '=', 'cancel'), '&amp;', ('state', '=', 'done'), ('is_locked', '=', True)]}" context="{'tree_view_ref': 'stock.view_stock_move_line_operation_tree', 'default_product_uom_id': product_uom, 'default_picking_id': picking_id, 'default_move_id': id, 'default_product_id': product_id, 'default_location_id': location_id, 'default_location_dest_id': location_dest_id}">
                  <tree string="Lineas" editable="bottom">
                    <field name="location_id"/>
                    <field name="location_dest_id"/>
                    <field name="lot_name"/>
                    <field name="invima"/>
                    <field name="expiration_date"/>
                    <field name="product_uom_qty"/>
                    <field name="qty_done"/>
                  </tree>
                </field>
                <footer class="oe_edit_only">
                    <button string="Confirmar" special="save" class="oe_highlight"/>
                    <button string="Descartar" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    
</odoo>


